function generateRandomFullName() {
  const lastNames = ["Nguyễn", "Trần", "Lê", "Phạm", "Hoàng", "Huỳnh", "Võ", "Đặng", "Bùi", "Đỗ"];
  const middleNames = ["Thị", "Hồng", "Quốc", "Văn", "Minh", "Diễm", "Nam", "Huy", "Thu", "Ngọc"];
  const firstNames = ["Văn", "Thanh", "Huy", "Thị", "Minh", "Hồng", "Nam", "Diễm", "Quốc", "Thu"];
  const randomLastName = lastNames[Math.floor(Math.random() * lastNames.length)];
  const randomMiddleName = middleNames[Math.floor(Math.random() * middleNames.length)];
  const randomFirstName = firstNames[Math.floor(Math.random() * firstNames.length)];
  return `${randomLastName} ${randomMiddleName} ${randomFirstName}`;
}
function generateRandomUserData() {
  const email = "huongdanng";
  const sdt = ""; // Số điện thoại mặc định
  const randomName = generateRandomFullName();
  const randomPhone = sdt ? sdt : "09" + Math.floor(10000000 + Math.random() * 90000000);
  const randomEmail = email + "+" + Math.floor(Math.random() * 1000) + "@gmail.com";
  const randomBirthday = new Date(1990 + Math.floor(Math.random() * 20), Math.floor(Math.random() * 12), Math.floor(Math.random() * 28));
  const randomArea = Math.floor(Math.random() * 2) + 3;
  const randomSex = Math.floor(Math.random() * 2);
  const formData = new FormData();
  formData.append("jpost", JSON.stringify({
    header: {
      CustomerId: 0,
      CustomerName: randomName,
      Phone: randomPhone,
      Email: randomEmail,
      BirthDay: randomBirthday.toISOString(),
      Area: randomArea,
      Sex: randomSex,
    },
  }));
  return formData;
}
function sendRandomUserData() {
  const randomUserData = generateRandomUserData();
  const xhr = new XMLHttpRequest();
  xhr.open("POST", "https://member.katinat.vn/Home/AddOrUpdateCustomer");
  xhr.onload = function () {
    if (xhr.status === 200) {
      const response = JSON.parse(xhr.responseText);
      if (response.Success && response.DataResult && response.DataResult.length > 0) {
        const customerId = response.DataResult[0].CustomerId;
        console.log("CustomerId từ máy chủ:", customerId);
        const customerNo = response.DataResult[0].CustomerNo;
        const jsonData = JSON.parse(randomUserData.get("jpost"));
        const name = jsonData.header.CustomerName;
        const phone = jsonData.header.Phone;
        const email = jsonData.header.Email;
        sendEmail(email, customerNo);
        sendSMS(phone, customerNo);
        const updatedFormData = generateUpdatedFormData(customerId, randomUserData);
        sendUpdatedData(updatedFormData);
        var userInfo = {
          "Họ tên": name,
          "Số điện thoại": phone,
          "Email": email
        };
        console.table(userInfo);
      } else {
        console.error("Lỗi trong phản hồi máy chủ:", response.MessageErrors);
      }
    } else {
      console.error("Lỗi trong quá trình gửi yêu cầu:", xhr.statusText);
    }
  };
  xhr.send(randomUserData);
}
function sendSMS(phone, customerNo) {
  const smsData = new FormData();
  smsData.append("Phone", phone);
  smsData.append("CustId", customerNo);
  const smsXhr = new XMLHttpRequest();
  smsXhr.open("POST", "https://member.katinat.vn/Home/SendSMS");
  smsXhr.onload = function () {
    if (smsXhr.status === 200) {
      console.log("Phản hồi từ yêu cầu gửi SMS:", smsXhr.responseText);
    } else {
      console.error("Lỗi trong quá trình gửi SMS:", smsXhr.statusText);
    }
  };
  smsXhr.send(smsData);
}
function sendEmail(email, customerNo) {
  const emailData = new FormData();
  emailData.append("Email", email);
  emailData.append("CustId", customerNo);
  const emailXhr = new XMLHttpRequest();
  emailXhr.open("POST", "https://member.katinat.vn/Home/SendEmail");
  emailXhr.onload = function () {
    if (emailXhr.status === 200) {
      console.log("Phản hồi từ yêu cầu gửi email:", emailXhr.responseText);
    } else {
      console.error("Lỗi trong quá trình gửi email:", emailXhr.statusText);
    }
  };
  emailXhr.send(emailData);
}
function generateUpdatedFormData(customerId, originalFormData) {
  const jsonData = JSON.parse(originalFormData.get("jpost"));
  jsonData.header.CustomerId = customerId;
  originalFormData.set("jpost", JSON.stringify(jsonData));
  return originalFormData;
}
function sendUpdatedData(updatedFormData) {
  const xhr = new XMLHttpRequest();
  xhr.open("POST", "https://member.katinat.vn/Home/AddOrUpdateCustomer");
  xhr.onload = function () {
    if (xhr.status === 200) {
      console.log("Phản hồi từ yêu cầu với formData đã cập nhật:", xhr.responseText);
    } else {
      console.error("Lỗi trong quá trình gửi yêu cầu:", xhr.statusText);
    }
  };
  xhr.send(updatedFormData);
}
sendRandomUserData();
